version: 2

sources:
  - name: tamanu
    schema: public
    description: "Tamanu database"
    tables:
      - name: notes
        description: "{{ doc('table__notes') }}"
        tags: ['clinical']
        columns:
          - name: id
            data_type: uuid
            description: "{{ doc('generic__id') }} for notes"
            data-tests:
              - unique
              - not_null
          - name: created_at
            data_type: timestamp with time zone
            description: "{{ doc('generic__created_at') }}"
            data-tests:
              - not_null
          - name: updated_at
            data_type: timestamp with time zone
            description: "{{ doc('generic__updated_at') }}"
            data-tests:
              - not_null
          - name: deleted_at
            data_type: timestamp with time zone
            description: "{{ doc('generic__deleted_at') }}"
          - name: note_type
            data_type: character varying
            description: "{{ doc('notes__note_type') }}"
            data-tests:
              - not_null
              - accepted_values:
                  values: [ "admission", "areaToBeImaged", "clinicalMobile", "dietary", "handover", "discharge",
                            "medical", "nursing", "other", "pharmacy", "physiotherapy", "resultDescription", "social",
                            "surgical", "system", "treatmentPlan" ]
          - name: record_id
            data_type: character varying
            description: "{{ doc('notes__record_id') }}"
            data-tests:
              - not_null
          - name: record_type
            data_type: character varying
            description: "{{ doc('notes__record_type') }}"
            data-tests:
              - not_null
              - accepted_values:
                  values: [ "Encounter", "ImagingRequest", "LabRequest", "Patient", "PatientCarePlan", "Triage" ]
          - name: date
            data_type: character
            description: "{{ doc('generic__date') }}"
            data-tests:
              - not_null
          - name: date_legacy
            data_type: timestamp with time zone
            description: "{{ doc('generic__date_legacy') }}"
          - name: updated_at_sync_tick
            data_type: bigint
            description: "{{ doc('generic__updated_at_sync_tick') }}"
            data-tests:
              - not_null
          - name: visibility_status
            data_type: text
            description: "{{ doc('generic__visibility_status') }}"
          - name: author_id
            data_type: character varying
            description: "{{ doc('users__id') }} that authored the note"
            data-tests:
              - relationships:
                  to: source('tamanu', 'users')
                  field: id
          - name: on_behalf_of_id
            data_type: character varying
            description: "{{ doc('users__id') }} the note was recorded on behalf of"
            data-tests:
              - relationships:
                  to: source('tamanu', 'users')
                  field: id
          - name: content
            data_type: text
            description: "{{ doc('notes__content') }}. Default value is ''"
          - name: revised_by_id
            data_type: uuid
            description: "[Deprecated] {{ doc('generic__id') }} of the user that revised the note."

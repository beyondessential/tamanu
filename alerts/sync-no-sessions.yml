sql: |
  SELECT
    COUNT(*) AS sessions_in_window,
    (SELECT MAX(created_at) FROM sync_sessions) AS last_session_created
  FROM sync_sessions
  WHERE created_at > now() - interval '30 minutes'
  HAVING COUNT(*) = 0

send:
  - target: external
    id: default
    subject: '[Tamanu Alert] No sync sessions created in the last 30 minutes ({{ hostname }})'
    template: |
      - Server: {{ hostname }}
      - Alert: {{ filename }}

      **Report this immediately to support.**

      No sync sessions have been created in the last 30 minutes.

      This could indicate:
      - Sync service is down or not running
      - Network connectivity issues
      - Database connection problems
      - All facilities are offline

      Last sync session was created at: {{ rows[0].last_session_created if rows[0].last_session_created else 'Unknown' }}

      **Immediate action required:**
      1. Check if sync service is running
      2. Verify database connectivity
      3. Check facility network status
      4. Review system logs for errors

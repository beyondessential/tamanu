# CHANGELOG

## vNEXT

### Manual steps required after upgrade ⚙

- Fiji only:
  - set appropriate HL7 settings in local.json
    - specifically:

```
  "hl7": {
    "assigners": {
      "patientDisplayId": "VRS"
    },
    "dataDictionaries": {
      "patientDisplayId": "http://data-dictionary.tamanu-fiji.org/application-reference-number.html",
      "labRequestDisplayId": "http://data-dictionary.tamanu-fiji.org/labrequest-reference-number.html"
    },
  },
```

- Everywhere:
  - set a `canonicalHostName` in `local.json`:

```
{
   "canonicalHostName": "https://example.com"
}
```

### Features ⭐

- Discharge modal now displays a list of active medicines that can be selected.
- Added integration with Fiji's VPS
- Added integration with Fiji's VRS

### Tweaks ⚖️

- EncounterMedication model now has two new fields: isDischarge and repeats.
- New migration for encounter_medications table to account for the new fields.
- Encounter api route now manages selected discharge medications.
- Split SelectField and MultiselectField into distinct components
- SelectField no longer internally tracks its value
- Remove 'required' attribute for Completed by and Location fields in ImagingRequestView

### Bug fixes 🐛

- Referrals now no longer display in the Programs tab

### Infrastructure and maintenance 🛠

- (left blank)

## v1.10.0

### Manual steps required after upgrade ⚙

- Set `serverFacilityId` in LAN local.json to a valid facilityId
  - Valid facilities will need to have been imported to sync server previously

### Features ⭐

- LAN server is aware of which facility it represents

### Tweaks ⚖️

- (left blank)

### Bug fixes 🐛

- (left blank)

### Infrastructure and maintenance 🛠

- (left blank)

## v1.9.0

### Manual steps required after upgrade ⚙

- Add appropriate codes for default department and location for surveys to `packages/lan-server/local.json`:

```
"survey": {
  "defaultCodes": {
    "department": "xxxxxx",
    "location": "xxxxxx",
  },
},
```

- Add to samoa `packages/sync-server/local.json`:

```
"tupaiaApiClient": {
    "auth": {
        "username": "tamanu-server@tupaia.org",
        "password": "" // find in lastpass, search for tamanu-server@tupaia.org
    },
    "environment": "production"
},
```

### Features ⭐

- Active COVID-19 Patients table

### Tweaks ⚖️

- Remove character limit on SurveyResponseAnswer.body

### Bug fixes 🐛

- Fix OutpatientDischarger performance and schedule not working.

### Infrastructure and maintenance 🛠

- Separate Facilities, Departments and Locations into distinct models
- Mitigate codeship awscli tools EB version name collision, in our deployment steps
- Deploy production meta-server from dev branch

## v1.8.0

### Manual steps required after upgrade ⚙

- (left blank)

### Features ⭐

- (left blank)

### Tweaks ⚖️

- (left blank)

### Bug fixes 🐛

- (left blank)

### Infrastructure and maintenance 🛠

- (left blank)

## v1.8.4

### Bug fixes 🐛

- Fix bug where loadshedder might fail to release lock

## v1.8.3

### Bug fixes 🐛

- Prevent sequelize nesting encounter queries on export

## v1.8.2

### Tweaks ⚖️

- Added loadshedder middleware to keep system more operational under load

## v1.8.1

### Bug fixes 🐛

- Disabled potentially unstable outpatient discharger task

## v1.8.0

### Manual steps required after upgrade ⚙

- (left blank)

### Features ⭐

- Add registered patients line-list report
- Add India assistive technology device line list report
- Add Iraq assistive technology device line list report
- Add PNG assistive technology device line list report
- Add Generic Vaccine line list report
- Allow disabling reports through server config
- Allow running reports in child process

### Tweaks ⚖️

- Renamed SyncMetadata to ChannelSyncPullCursor
- Facility server now throws an error when connecting to a sync server if it had previously connected to a different one
- Reports generated by sync server are zipped before sending out via email
- Limit /sync/channels concurrency to 8 (by default) concurrent queries to reduce connection pool contention

### Bug fixes 🐛

- Changed Country to Country of birth and only allow ALL FACILITIES in registered patients line-list report

### Infrastructure and maintenance 🛠

- Removed Tonga from meta-server
- Made ./scripts/version.sh safer

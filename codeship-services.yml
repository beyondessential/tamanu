app:
  build: .
  encrypted_env_file: codeship.env.encrypted
  cached: true
  default_cache_branch: dev
  volumes:
    - ./.tmp:/tamanu
    - ./.ssh:/root/.ssh
  environment:
    ELECTRON_CONFIG_CACHE: "$HOME/cache/electron"
    NODE_CONFIG: '{"db":{"name":"postgres","host":"postgres","username":"postgres","password":"postgres"}}'
  depends_on:
    - postgres

awsdeployment:
  build:
    dockerfile: Dockerfile.deploy
  encrypted_env_file: codeship.env.encrypted
  cached: true
  default_cache_branch: dev
  volumes:
    - ./.tmp:/tamanu
    - ./.ssh:/root/.ssh

postgres:
  image: healthcheck/postgres
  cached: true
  default_cache_branch: dev
  environment:
    - POSTGRES_DB=postgres
    - POSTGRES_USER=postgres
    - POSTGRES_PASSWORD=postgres
    - 'POSTGRES_INITDB_ARGS=--encoding=UTF-8 --lc-collate=C --lc-ctype=C'

mobile:
  build:
    image: tamanu-mobile
    context: packages/mobile
    dockerfile: Dockerfile
  encrypted_dockercfg_path: packages/mobile/dockercfg.encrypted

dockercfg-generator:
  image: codeship/aws-ecr-dockercfg-generator
  add_docker: true
  encrypted_env_file: codeship.env.encrypted

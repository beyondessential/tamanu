app: &app
  build: .
  encrypted_env_file: codeship.env.encrypted
  volumes:
    - ./.tmp:/tamanu
    - ./.ssh:/root/.ssh
  environment: &app_environment
    ELECTRON_CONFIG_CACHE: "$HOME/cache/electron"

app-with-mongo:
  <<: *app
  depends_on:
    - mongodb
  environment:
    <<: *app_environment
    DB_PATH: "mongodb://mongodb:27017"
    DB_TYPE: "mongodb"

awsdeployment:
  build:
    dockerfile: Dockerfile.deploy
  encrypted_env_file: codeship.env.encrypted
  volumes:
    - ./.tmp:/tamanu
    - ./.ssh:/root/.ssh

mongodb:
  image: healthcheck/mongo
  ports:
      - 27017:27017

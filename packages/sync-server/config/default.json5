{
  "port": 3000,
  // this should be set to the external address of the server, e.g. "https://central.main.internal.tamanu.io"
  "canonicalHostName": "http://localhost:3000",
  "db": {
    "name": "tamanu-sync",
    // when verbose to true, log.consoleLevel must be set to "debug" to see any output
    "verbose": false,
    "username": "",
    "password": "",
    "migrateOnStartup": false,
    "pool": {
      "max": 10
      // "min": 5,
      // "idle": 10000,
      // "acquire": 60000,
      // "evict": 1000
    },
    "reportSchemas": {
      "enabled": false,
      "connections": {
        "raw": {
          "pool": {
            "max": 5
          },
          "username": "",
          "password": ""
        },
        "reporting": {
          "pool": {
            "max": 5
          },
          "username": "",
          "password": ""
        }
      }
    }
  },
  "updateUrls": {
    "mobile": ""
  },
  "log": {
    "path": "",
    "consoleLevel": "http",
    "color": true
  },
  "honeycomb": {
    "apiKey": "",
    "sampleRate": 100, // 100 = 1/100 = 1% of traces get sent to honeycomb
    // in contrast, logs are always sent
    "enabled": true,
    "level": "info"
  },
  "sync": {
    "maxConcurrentSessions": 1,
    "persistedCacheBatchSize": 20000,
    "pauseBetweenPersistedCacheBatchesInMilliseconds": 50,
    "adjustDataBatchSize": 20000,
    "syncAllEncountersForTheseVaccines": [],
    "numberConcurrentPullSnapshots": 4,
    "persistUpdateWorkerPoolSize": 5,
    // at its very large default, maxRecordsPerPullSnapshotChunk is essentially "off"
    // can be turned on by lowering to some amount that seems appropriate if snapshot performance is an issue
    "maxRecordsPerPullSnapshotChunk": 1000000000
  },
  "loadshedder": {
    // paths are checked sequentially until a path matches a prefix
    // (e.g. the path `/v1/sync/xxx/pull` would match the prefix `/v1/sync/`)
    //
    // if the path of a request matches a prefix it is added to that queue and
    // may be dropped under heavy load
    //
    // if the path of a request matches nothing, the server never drops the
    // request
    "queues": [
      // sync queue
      // (defaults to shedding requests for sync or attachments earlier than other requests)
      {
        "name": "low_priority",
        "prefixes": ["/v1/sync", "/v1/attachment"],
        "maxActiveRequests": 4,
        "maxQueuedRequests": 8,
        "queueTimeout": 7500
      },
      // global queue for non-sync non-attachment requests
      // (defaults to queueing more requests than sync/attachments and them shedding much later)
      {
        "name": "high_priority",
        "prefixes": ["/"],
        "maxActiveRequests": 8,
        "maxQueuedRequests": 32,
        "queueTimeout": 7500
      }
    ]
  },
  "auth": {
    // these secrets should be set if more than one process of the sync-server is running
    // otherwise, each process will use a different key and tokens won't match
    "secret": null,
    "saltRounds": 12,
    "tokenDuration": "1h",
    "reportNoUserError": false,
    "useHardcodedPermissions": true,
    "refreshToken": {
      "secret": null,
      "tokenDuration": "30d",
      "absoluteExpiration": false,
      "refreshIdLength": 54
    },
    "resetPassword": {
      "tokenLength": 6,
      "tokenExpiry": 20
    }
  },
  "export": {
    "maxFileSizeInMB": 50
  },
  "mailgun": {
    "domain": "",
    "apiKey": "",
    "from": ""
  },
  "cors": {
    "allowedOrigin": ""
  },
  "schedules": {
    // batchSize == run through them all in one run, in batches of N
    // limit == run through N per task run
    // schedule: 5 fields == first is minutes, 6 fields == first is SECONDS
    "outpatientDischarger": {
      // every day at 2 AM
      "schedule": "0 2 * * *",
      "batchSize": 1000,
      "batchSleepAsyncDurationInMilliseconds": 50
    },
    "patientEmailCommunicationProcessor": {
      // every 30seconds /!\
      "schedule": "*/30 * * * * *",
      "limit": 10
    },
    "deceasedPatientDischarger": {
      // once an hour
      "schedule": "29 * * * *",
      "batchSize": 100,
      "batchSleepAsyncDurationInMilliseconds": 50
    },
    "patientMergeMaintainer": {
      // once an hour at minute 12
      "schedule": "12 * * * *"
    },
    "certificateNotificationProcessor": {
      // every 30 seconds /!\
      "schedule": "*/30 * * * * *",
      "limit": 10
    },
    "reportRequestProcessor": {
      // every 30 seconds /!\
      "schedule": "*/30 * * * * *",
      "limit": 10
    },
    "signerRenewalChecker": {
      "schedule": "0 0 * * *"
    },
    "signerRenewalSender": {
      // needs to happen after the Renewal Checker, and regularly thereafter as a retry mechanism
      "schedule": "30 * * * *"
    },
    "signerWorkingPeriodChecker": {
      "schedule": "0 1 * * *"
    },
    "automaticLabTestResultPublisher": {
      "enabled": false,
      "schedule": "*/15 * * * *",
      "limit": 300,
      "results": {
        "labTestType-RATPositive": {
          "labTestMethodId": "labTestMethod-RAT",
          "result": "Positive"
        },
        "labTestType-RATNegative": {
          "labTestMethodId": "labTestMethod-RAT",
          "result": "Negative"
        }
      }
    },
    "covidClearanceCertificatePublisher": {
      "enabled": false,
      "schedule": "*/30 * * * *"
    },
    "fhirMissingResources": {
      "enabled": true,
      "schedule": "48 1 * * *" // once a day, time does not matter (better in off hours)
    },
    "plannedMoveTimeout": {
      "enabled": true,
      // Once an hour
      "schedule": "0 * * * *",
      "timeoutHours": 24,
      "batchSize": 100,
      "batchSleepAsyncDurationInMilliseconds": 50
    },
    "staleSyncSessionCleaner": {
      "enabled": true,
      "schedule": "* * * * *",
      "staleSessionSeconds": 3600
    },
    "processSyncQueue": {
      "enabled": true,
      "schedule": "* * * * *"
    }
  },
  "integrations": {
    "fijiVrs": {
      "enabled": false,
      "host": "http://uat-vra.digitalfiji.gov.fj:8786",
      "username": null,
      "password": null,
      // refresh the token if it's within tokenExpiryMarginMs milliseconds of expiry
      "tokenExpiryMarginMs": 60000,
      "flagInsteadOfDeleting": true,
      "retrySchedule": "*/30 * * * * *",
      // don't retry pending records unless they're retryMinAgeMs old
      "retryMinAgeMs": 60000,
      "requireClientHeaders": true
    },
    "fijiVps": {
      "enabled": false,
      "requireClientHeaders": true
    },
    "euDcc": {
      "enabled": false,
      "issuer": null // Responsible org for vax cert issuance, e.g. 'Ministry of Health of the Tamanu Republic'. If null defaults to the facility name.
    },
    "vdsNc": {
      "enabled": false
    },
    "signer": {
      "enabled": false,
      // Encryption key for ICAO Signer key material (stored in DB).
      // This must be unique per country/installation AND NEVER CHANGED.
      // It must be at least 32 bytes of random data in Base64.
      // $ openssl rand -base64 32
      "keySecret": null,
      // For VDS-NC: exactly 2 uppercase letters/numbers, must be unique in country, ref 9303-13 §2.2.1(a)
      // For EU DCC: at least 1 character, must be unique in country, should be descriptive
      "commonName": "TA",
      // For EU DCC only: the name of the issuing organisation (provider/O of the DSC)
      // "provider": "Tamanu",
      // Email address for CSCA signing contact
      "sendRequestTo": "admin@tamanu.io"
    },
    "fijiAspenMediciReport": {
      "enabled": false
    },
    "mSupply": {
      "enabled": false,
      "requireClientHeaders": true
    },
    "fhir": {
      // Enabling the HTTP routes and enabling the worker are completely separate:
      // one may be enabled without the other and vice versa. The worker is on by
      // default so that FHIR resources can be used as a target for reports without
      // the FHIR API being exposed to the public in a deployment that doesn't need it.
      "enabled": false, // the HTTP routes
      "worker": {
        "enabled": true, // the materialisation worker
        "concurrency": 100
      },
      "parameters": {
        "_count": {
          "default": 20,
          "max": 20
        }
      }
    },
    "omniLab": {
      "enabled": false,
      // Must be set to a random value, and the value must be saved somewhere (at BES we use lastpass)
      // New keys may be issued by running `node dist/app.bundle.js apiKeys issue fhirIntegration <email> -e '100 years'
      // If this is changed, all API keys using this secret will be revoked and must be reissued
      "secret": null
    }
  },
  // on the sync-server, don't read these values from config!
  // use the getLocalisation() helper in packages/sync-server/app/localisation.js
  // this will ensure we can read these values from the database in the future
  "localisation": {
    "allowInvalid": false,
    // the labResultWidget and timeZone keys are here for legacy reasons
    // don't put anything else in the top level of localisation unless it relates to localisation itself
    "labResultWidget": {
      "categoryWhitelist": ["labTestCategory-COVID"],
      "testTypeWhitelist": ["labTestType-COVID"]
    },
    "data": {
      // To do: review this section when implementing the patient charts feature
      "units": {
        "temperature": "celsius"
      },
      "country": {
        "name": "",
        "alpha-2": "",
        "alpha-3": ""
      },
      "fields": {
        "countryName": {
          "hidden": false
        },
        "emergencyContactName": {
          "requiredPatientData": false
        },
        "emergencyContactNumber": {
          "requiredPatientData": false
        },
        "displayId": {
          "pattern": "[\\s\\S]*"
        },
        "firstName": {
          "requiredPatientData": false
        },
        "middleName": {
          "hidden": false,
          "requiredPatientData": false
        },
        "lastName": {
          "requiredPatientData": false
        },
        "culturalName": {
          "hidden": false,
          "requiredPatientData": false
        },
        "sex": {
          "hidden": false,
          "requiredPatientData": false
        },
        "email": {
          "hidden": false,
          "requiredPatientData": false
        },
        "dateOfBirth": {
          "requiredPatientData": false
        },
        "bloodType": {
          "hidden": false,
          "requiredPatientData": false
        },
        "title": {
          "hidden": false,
          "requiredPatientData": false
        },
        "placeOfBirth": {
          "hidden": false,
          "requiredPatientData": false
        },
        "countryOfBirthId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "maritalStatus": {
          "hidden": false,
          "requiredPatientData": false
        },
        "primaryContactNumber": {
          "hidden": false,
          "requiredPatientData": false
        },
        "secondaryContactNumber": {
          "hidden": false,
          "requiredPatientData": false
        },
        "socialMedia": {
          "hidden": false,
          "requiredPatientData": false
        },
        "settlementId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "streetVillage": {
          "hidden": false,
          "requiredPatientData": false
        },
        "cityTown": {
          "hidden": false,
          "requiredPatientData": false
        },
        "subdivisionId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "divisionId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "countryId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "medicalAreaId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "nursingZoneId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "nationalityId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "ethnicityId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "occupationId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "educationalLevel": {
          "hidden": false,
          "requiredPatientData": false
        },
        "villageName": {
          "hidden": false
        },
        "villageId": {
          "hidden": false
        },
        "birthCertificate": {
          "hidden": false,
          "requiredPatientData": false
        },
        "drivingLicense": {
          "hidden": false,
          "requiredPatientData": false
        },
        "passport": {
          "hidden": false,
          "requiredPatientData": false
        },
        "religionId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "patientBillingTypeId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "motherId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "fatherId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "birthWeight": {
          "hidden": false,
          "requiredPatientData": false
        },
        "birthLength": {
          "hidden": false,
          "requiredPatientData": false
        },
        "birthDeliveryType": {
          "hidden": false,
          "requiredPatientData": false
        },
        "gestationalAgeEstimate": {
          "hidden": false,
          "requiredPatientData": false
        },
        "apgarScoreOneMinute": {
          "hidden": false,
          "requiredPatientData": false
        },
        "apgarScoreFiveMinutes": {
          "hidden": false,
          "requiredPatientData": false
        },
        "apgarScoreTenMinutes": {
          "hidden": false,
          "requiredPatientData": false
        },
        "timeOfBirth": {
          "hidden": false,
          "requiredPatientData": false
        },
        "attendantAtBirth": {
          "hidden": false,
          "requiredPatientData": false
        },
        "nameOfAttendantAtBirth": {
          "hidden": false,
          "requiredPatientData": false
        },
        "birthType": {
          "hidden": false,
          "requiredPatientData": false
        },
        "birthFacilityId": {
          "hidden": false,
          "requiredPatientData": false
        },
        "registeredBirthPlace": {
          "hidden": false,
          "requiredPatientData": false
        },
        "referralSourceId": {
          "hidden": false
        },
        "arrivalModeId": {
          "hidden": false
        },
        "prescriber": {
          "hidden": false
        },
        "prescriberId": {
          "hidden": false
        },
        "facility": {
          "hidden": false
        },
        "dischargeDisposition": {
          "hidden": true
        }
      },
      "features": {
        "editPatientDetailsOnMobile": true,
        "quickPatientGenerator": false,
        "enableInvoicing": false,
        "registerNewPatient": true,
        "hideOtherSex": true,
        "enablePatientDeaths": false,
        "mergePopulatedPADRecords": true,
        "enableNoteBackdating": true,
        "enableCovidClearanceCertificate": false,
        "editPatientDisplayId": false,
        "patientPlannedMove": false,
        "idleTimeout": {
          "enabled": true,
          // All values in seconds
          "timeoutDuration": 600,
          "warningPromptDuration": 30,
          "refreshInterval": 150
        },
        "fhirNewZealandEthnicity": false,
        "onlyAllowLabPanels": false,
        "displayProcedureCodesInDischargeSummary": true,
        "displayIcd10CodesInDischargeSummary": true,
        "tableAutoRefresh": {
          "enabled": false,
          // In Seconds
          "interval": 300
        },
        "mandatoryVitalEditReason": false,
        "enableVitalEdit": false
      },
      "templates": {
        "letterhead": {
          "title": "TAMANU MINISTRY OF HEALTH & MEDICAL SERVICES",
          "subTitle": "PO Box 12345, Melbourne, Australia"
        },
        "signerRenewalEmail": {
          "subject": "Tamanu ICAO Certificate Signing Request",
          "body": "Please sign the following certificate signing request (CSR) with the Country Signing Certificate Authority (CSCA), and return it to the Tamanu team or Tamanu deployment administration team."
        },
        "vaccineCertificateEmail": {
          "subject": "Medical Certificate now available",
          "body": "A medical certificate has been generated for you.\nYour certificate is available attached to this email."
        },
        "covidVaccineCertificateEmail": {
          "subject": "Medical Certificate now available",
          "body": "A medical certificate has been generated for you.\nYour certificate is available attached to this email."
        },
        "covidTestCertificateEmail": {
          "subject": "Medical Certificate now available",
          "body": "A medical certificate has been generated for you.\nYour certificate is attached to this email."
        },
        "covidClearanceCertificateEmail": {
          "subject": "COVID-19 Clearance Certificate now available",
          "body": "A COVID-19 clearance certificate has been generated for you.\nYour certificate is attached to this email."
        },
        "vaccineCertificate": {
          "emailAddress": "tamanu@health.gov",
          "contactNumber": "12345",
          "healthFacility": "State level"
        },
        "covidTestCertificate": {
          "laboratoryName": "Approved test provider",
          "clearanceCertRemark": "This notice certifies that $firstName$ $lastName$ is no longer considered infectious following 13 days of self-isolation from the date of their first positive SARS-CoV-2 test and are medically cleared from COVID-19. This certificate is valid for 3 months from the date of issue."
        },
        "plannedMoveTimeoutHours": 24
      },
      "imagingTypes": {
        // keys are taken from IMAGING_TYPES in shared/constants/imaging
        // e.g.
        // "xRay": { "label": "X-Ray" }
      },
      "imagingPriorities": [
        {
          "value": "routine",
          "label": "Routine"
        },
        {
          "value": "urgent",
          "label": "Urgent"
        },
        {
          "value": "asap",
          "label": "ASAP"
        },
        {
          "value": "stat",
          "label": "STAT"
        }
      ],
      "imagingCancellationReasons": [
        {
          "value": "clinical",
          "label": "Clinical reason"
        },
        {
          "value": "duplicate",
          "label": "Duplicate"
        },
        {
          "value": "entered-in-error",
          "label": "Entered in error"
        },
        {
          "value": "patient-discharged",
          "label": "Patient discharged"
        },
        {
          "value": "patient-refused",
          "label": "Patient refused"
        },
        {
          "value": "other",
          "label": "Other"
        }
      ],
      "labsCancellationReasons": [
        {
          "value": "clinical",
          "label": "Clinical reason"
        },
        {
          "value": "duplicate",
          "label": "Duplicate"
        },
        {
          "value": "entered-in-error",
          "label": "Entered in error"
        },
        {
          "value": "patient-discharged",
          "label": "Patient discharged"
        },
        {
          "value": "patient-refused",
          "label": "Patient refused"
        },
        {
          "value": "other",
          "label": "Other"
        }
      ],
      "printMeasures": {
        "labRequestPrintLabel": {
          "width": 50.8
        },
        "stickerLabelPage": {
          "pageWidth": "210mm",
          "pageHeight": "297mm",
          "pageMarginTop": "15.09mm",
          "pageMarginLeft": "6.4mm",
          "columnTotal": 3,
          "columnWidth": "64mm",
          "columnGap": "3.01mm",
          "rowTotal": 10,
          "rowHeight": "26.7mm",
          "rowGap": "0"
        },
        "idCardPage": {
          "cardMarginTop": "1mm",
          "cardMarginLeft": "5mm"
        }
      },
      // The time zone setting is currently only used for Vaccine Certificates
      // Todo: remove this timeZone once all date fields have been migrated to date_time_strings
      "timeZone": null,
      "triageCategories": [
        {
          "level": 1,
          "label": "Emergency",
          "color": "#F76853"
        },
        {
          "level": 2,
          "label": "Very Urgent",
          "color": "#F17F16"
        },
        {
          "level": 3,
          "label": "Urgent",
          "color": "#FFCC24"
        },
        {
          "level": 4,
          "label": "Non-urgent",
          "color": "#47CA80"
        },
        {
          "level": 5,
          "label": "Deceased",
          "color": "#67A6E3"
        }
      ],
      // UVCI format for vaccine certificate *previews* on Desktop.
      // This should match whichever of integrations.euDcc or .vdsNc is enabled, and
      // does *not* affect which format is used for the actual PDF certificate when
      // generated in the sync server. Can be `tamanu` or `icao` or `eudcc`.
      // `tamanu` implies that the signing integrations are not enabled.
      "previewUvciFormat": "tamanu",
      "disabledReports": [],
      "vitalEditReasons": [
        {
          "value": "incorrect-patient",
          "label": "Incorrect patient"
        },
        {
          "value": "incorrect-value",
          "label": "Incorrect value recorded"
        },
        {
          "value": "recorded-in-error",
          "label": "Recorded in error"
        },
        {
          "value": "other",
          "label": "Other"
        }
      ],
      "ageDisplayFormat": [
        {
          "as": "days",
          "range": {
            "min": { "duration": { "days": 0 } },
            "max": { "duration": { "days": 8 }, "exclusive": true }
          }
        },
        {
          "as": "weeks",
          "range": {
            "min": { "duration": { "days": 8 } },
            "max": { "duration": { "months": 1 }, "exclusive": true }
          }
        },
        {
          "as": "months",
          "range": {
            "min": { "duration": { "months": 1 } },
            "max": { "duration": { "years": 2 }, "exclusive": true }
          }
        },
        {
          "as": "years",
          "range": {
            "min": { "duration": { "years": 2 } }
          }
        }
      ],
      "supportDeskUrl": "https://bes-support.zendesk.com/hc/en-us"
    }
  },
  "reportProcess": {
    // Report process timeout in 2 hours.
    "timeOutDurationSeconds": 7200,
    "runInChildProcess": true,
    // provide an array [] if you want to override the options, eg: ['--max-old-space-size=4096']
    "processOptions": null,
    // Provide an object {} for the env of child process
    "childProcessEnv": null
  },
  "hl7": {
    "nullLastNameValue": "NoLastName",
    "assigners": {
      "patientDisplayId": "Tamanu",
      "patientDrivingLicense": "RTA",
      "patientPassport": "Fiji Passport Office"
    },
    "dataDictionaries": {
      "testMethod": "http://tamanu.io/data-dictionary/covid-test-methods",
      "patientDisplayId": "http://tamanu.io/data-dictionary/application-reference-number.html",
      "labRequestDisplayId": "http://tamanu.io/data-dictionary/labrequest-reference-number.html",
      "areaExternalCode": "http://data-dictionary.tamanu-fiji.org/rispacs-billing-code.html",
      "encounterClass": "http://terminology.hl7.org/CodeSystem/v3-ActCode",
      "serviceRequestImagingDisplayId": "http://data-dictionary.tamanu-fiji.org/tamanu-mrid-imagingrequest.html",
      "serviceRequestImagingId": "http://data-dictionary.tamanu-fiji.org/tamanu-id-imagingrequest.html",
      "serviceRequestLabDisplayId": "http://data-dictionary.tamanu-fiji.org/tamanu-mrid-labrequest.html",
      "serviceRequestLabId": "http://data-dictionary.tamanu-fiji.org/tamanu-id-labrequest.html",
      "imagingStudyAccessionId": "http://data-dictionary.tamanu-fiji.org/ris-accession-number.html",
      "ethnicityId": "http://data-dictionary.tamanu-fiji.org/extensions/ethnic-group-code.html",
      "locationPhysicalType": "http://terminology.hl7.org/CodeSystem/location-physical-type"
    }
  },
  "s3": {},
  "scheduledReports": [],
  "disk": {
    "diskPath": "C:/",
    "freeSpaceRequired": {
      "gigabytesForUploadingDocuments": 16
    }
  },
  // Note: this config should be duplicated on the lan server if the same behavior is
  // desired for "this facility" and "all facilities"
  "reportConfig": {
    "encounter-summary-line-list": {
      "includedPatientFieldIds": []
    }
  },
  "questionCodeIds": {
    "passport": null,
    "nationalityId": null,
    "email": null
  },
  "notifications": {
    "certificates": {
      "labTestCategoryIds": []
    }
  },
  "proxy": {
    // Possible values: https://expressjs.com/en/guide/behind-proxies.html
    //
    // This should only be set to servers we trust! `loopback` is a safe default
    // because it means we only trust proxies running on the machine itself, e.g.
    // local nginx.
    //
    // As of 29/08/2022 all our deployments are behind a local nginx proxy and so
    // this shouldn't need to be changed.
    "trusted": ["loopback"]
  },
  "patientMerge": {
    // can be one of "RENAME", "DESTROY", or "NONE"
    // RENAME sets the patient's firstName to 'Deleted' and lastName to 'Patient'
    // DESTROY sets deleted_at to a timestamp
    // NONE is a no-op and does nothing
    "deletionAction": "RENAME"
  },
  "validateQuestionConfigs": {
    "enabled": false
  },
  // this should be an IANA tzdata timezone
  // @see here for a list of available options https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  "countryTimeZone": "Australia/Melbourne",
  "allowMismatchedTimeZones": false
}

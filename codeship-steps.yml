- name: copy_files
  service: app
  command: /.tmp/scripts/copy_files.sh
- name: reinstate_ssh
  service: app
  command: ./scripts/fix_ssh.sh
- name: install_dependencies
  service: app
  command: ./scripts/install.sh
- name: test
  service: app
  command: ./scripts/test.sh
- name: build
  service: app
  # TODO: uncomment
  # tag: ^(master|dev|ci-)
  command: ./scripts/build.sh demo
- name: push_artefacts_to_s3
  service: awsdeployment
  tag: ^(dev|ci-)
  command: ./scripts/push.sh

- name: deploy_sync_dev_environment
  # TODO: uncomment
  # tag: dev
  service: awsdeployment
  command: ./scripts/deploy_sync_server_dev.sh

- type: manual
  tag: master
  steps:
    - name: push-master
      service: awsdeployment
      command: ./scripts/push.sh
    - name: deploy-master
      service: awsdeployment
      command: ./scripts/deploy.sh demo
